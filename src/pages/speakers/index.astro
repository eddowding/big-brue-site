---
import Layout from '../../layouts/Layout.astro';
import SpeakerCard from '../../components/SpeakerCard.astro';
import { getCollection } from 'astro:content';

const allSpeakers = await getCollection('speakers');
const speakers = allSpeakers.sort((a, b) => (a.data.order || 99) - (b.data.order || 99));

// Get unique categories
const allCategories = [...new Set(speakers.flatMap(s => s.data.categories || []))];
---

<Layout title="Speakers" description="Meet the inspiring voices at Big Brue - artists, writers, thinkers and global decision-makers.">
  <section class="bg-blush pt-28 md:pt-32 pb-16 md:pb-20">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="max-w-3xl">
        <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold text-sludge tracking-tight mb-4">
          SPEAKERS
        </h1>
        <p class="text-lg md:text-xl text-sludge/80 leading-relaxed">
          Inspirational voices from the worlds of art, culture, politics, literature and the environment.
        </p>
      </div>
    </div>
  </section>

  <section class="py-12 md:py-16 bg-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Category Filter -->
      <div class="flex flex-wrap gap-2 mb-10">
        <button
          class="filter-btn px-5 py-2 rounded-full font-bold text-sm transition-colors bg-sludge text-white"
          data-category="all"
        >
          All
        </button>
        {allCategories.map(category => (
          <button
            class="filter-btn px-5 py-2 rounded-full font-bold text-sm transition-colors bg-white text-sludge border-2 border-sludge/20 hover:border-sludge"
            data-category={category}
          >
            {category.charAt(0).toUpperCase() + category.slice(1)}
          </button>
        ))}
      </div>

      <!-- Speakers Grid -->
      <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6" id="speakers-grid">
        {speakers.map((speaker, index) => (
          <div class="speaker-item" data-categories={JSON.stringify(speaker.data.categories || [])}>
            <SpeakerCard
              name={speaker.data.name}
              role={speaker.data.role}
              photo={speaker.data.photo}
              slug={speaker.slug}
              index={index}
            />
          </div>
        ))}
      </div>

      <!-- Empty State -->
      <div id="empty-state" class="hidden text-center py-16">
        <p class="text-lg text-warm-black/60">No speakers found in this category.</p>
      </div>
    </div>
  </section>
</Layout>

<script>
  const filterBtns = document.querySelectorAll('.filter-btn');
  const speakerItems = document.querySelectorAll('.speaker-item');
  const emptyState = document.getElementById('empty-state');

  filterBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const category = btn.getAttribute('data-category');

      // Update button styles
      filterBtns.forEach(b => {
        b.classList.remove('bg-sludge', 'text-white');
        b.classList.add('bg-white', 'text-sludge', 'border-2', 'border-sludge/20');
      });
      btn.classList.remove('bg-white', 'text-sludge', 'border-2', 'border-sludge/20');
      btn.classList.add('bg-sludge', 'text-white');

      // Filter speakers
      let visibleCount = 0;
      speakerItems.forEach(item => {
        const categories = JSON.parse(item.getAttribute('data-categories') || '[]');
        const shouldShow = category === 'all' || categories.includes(category);

        if (shouldShow) {
          item.classList.remove('hidden');
          visibleCount++;
        } else {
          item.classList.add('hidden');
        }
      });

      // Show/hide empty state
      if (emptyState) {
        if (visibleCount === 0) {
          emptyState.classList.remove('hidden');
        } else {
          emptyState.classList.add('hidden');
        }
      }
    });
  });
</script>
